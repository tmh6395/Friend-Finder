<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Survey Page</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" />
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<style>
		html,
		body {
			background-color: gray;
			min-height: 100%;}

		.jumbotron {
			background-color: lightgray;
			padding-left: 5rem;
			padding-right: 5rem;}

		#title-text,
		#extra-links {text-align: center;}

		.row,
		#submit-button {width: 100%;}

		h2 {font-size: 30px;}

		p {font-size: 30px;}

		#extra-links {
			font-size: 20px;
			margin-top: 1rem;}

		hr {background-color: darkgray;}

		.select-choice {width: 150px;}

		img {width: 100%;}
	</style>
	<script src="https://code.jquery.com/jquery.js"></script>
</head>

<body>

	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-8 mb-4">
			<div class="container">
				<h1>Survey Questions</h1>
				<hr />
				<h2>About You</h2>
				<form>
					<div class="form-group">
						<label for="name">Name (Required)</label>
						<input type="text" class="form-control" id="name" aria-describedby="name" />
					</div>
					<div class="form-group">
						<label for="url">Link to Photo Image (Required)</label>
						<input type="url" class="form-control" id="url" aria-describedby="url" />
					</div>

					<hr />

					<h3>Question 1</h3>
					<h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
					<label for="question-one"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-one">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 2</h3>
					<h4>Generally speaking, you rely more on your experience than your imagination.</h4>
					<label for="question-two"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-two">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />
					<h3>Question 3</h3>
					<h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>
					<label for="question-three"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-three">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 4</h3>
					<h4>You rarely do something just out of sheer curiosity.</h4>
					<label for="question-four"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-four">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 5</h3>
					<h4>People can rarely upset you.</h4>
					<label for="question-five"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-five">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 6</h3>
					<h4>It is often difficult for you to relate to other people’s feelings.</h4>
					<label for="question-six"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-six">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 7</h3>
					<h4>In a discussion, truth should be more important than people’s sensitivities.</h4>
					<label for="question-seven"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-seven">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 8</h3>
					<h4>You rarely get carried away by fantasies and ideas.</h4>
					<label for="question-eight"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-eight">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 9</h3>
					<h4>You think that everyone’s views should be respected regardless of whether they are supported by
						facts or not.</h4>
					<label for="question-nine"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-nine">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>

					<hr />

					<h3>Question 10</h3>
					<h4>You feel more energetic after spending time with a group of people.</h4>
					<label for="question-ten"></label>
					<select class="custom-select custom-select-sm select-choice" id="question-ten">
						<option disabled>Select an Option</option>
						<option value="1">1 (Strongly Disagree)</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5 (Strongly Agree)</option>
					</select>
				</form>

				<button type="button" class="btn btn-primary mt-4" id="submit-button" data-toggle="modal"
					data-target="#exampleModal">
					Submit Results
				</button>

			</div>
			<hr />
			<!-- Links to /api/friends & github repo go here -->
			<p id="extra-links"><a href="/api/friends" target="_blank">Link to /api/friends</a> | <a
					href="https://github.com/tmh6395/Friend-Finder" target="_blank">Link to this project's
					Github Repository</a></p>
		</div>
		<div class="col-md-2"></div>
	</div>


	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Thank You for Using Friend Finder!</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="modal-failure">
					Please give both your name and a link to an image of you!
				</div>
				<div class="modal-body" id="modal-success">
					<div>
						<img id="image-link" src="" alt="Could not find the image" />
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>

</body>

</html>

<script type="text/javascript">

	// Click handler for the submit/modal button.
	$("#submit-button").on("click", function (event) {
		event.preventDefault();
		let newName = $("#name").val().trim();
		let newPhoto = $("#url").val().trim();
		// If either the name or photo URL text boxes are empty, shows a modal saying to reinput info.
		if (!newName || !newPhoto) {
			$("#exampleModalLabel").html("Our apologies, but there was an issue.");
			$("#modal-success").hide();
			$("#modal-failure").show();
		}
		// Else shows the modal div that houses the info of our friend-to-be,
			// and also creates a new friend object (you), which will be posted
			// to /api/friends later.
		else {
			$("#modal-failure").hide();
			$("#modal-success").show();
			// Make "newFriend" object and insert values into it
			let newFriend = {
				name: newName,
				photo: newPhoto,
				scores: [
					$("#question-one").val(),
					$("#question-two").val(),
					$("#question-three").val(),
					$("#question-four").val(),
					$("#question-five").val(),
					$("#question-six").val(),
					$("#question-seven").val(),
					$("#question-eight").val(),
					$("#question-nine").val(),
					$("#question-ten").val()
				],
				scoreDifference: 0
			};


			// This function calculates the differences in scores for each potential friend
			function calculateScoreDifferences(data) {
				let currentScoreCheck = 0;
				for (let i in data) {
					let totalDifference = 0;
					for (let j in data[i].scores) {
						totalDifference += (Math.abs(newFriend.scores[i] - data[i].scores[j]));
					}
					// (this little area between the for-loop-ending-brackets marks the space between each cat)

					// It is here where we set each cat's "score difference". This value represents the cat's
						// score difference relative to the newly entered person (your info).
					// The score difference is set to 0 to reset it for the next person to input their info; otherwise
						// results would carry over to the next input and would not be accurate
					data[i].scoreDifference = totalDifference;
					data[i].currentScoreCheck = data[i].scoreDifference;
					data[i].scoreDifference = 0;
				}

				// This part of the code updates the modal that shows the best match. It first presets a variable very high,
					// then checks the score of each potential friend. Every time a new friend turns up with a better score,
					// the modal gets updated with the new friend's name and image.
				let bestFriendMatch = 99;
				for (let i in data) {
					if (data[i].currentScoreCheck < bestFriendMatch) {
						bestFriendMatch = data[i].currentScoreCheck;
						$("#image-link").removeAttr("src");
						$("#exampleModalLabel").html(data[i].name);
						$("#image-link").attr("src", data[i].photo);
					}
				}
				bestFriendMatch = 99;
			}


			// GET method: get info from /api/friends
			$.get("/api/friends",function (data) {
				if (data) {
					calculateScoreDifferences(data);
				}
			});

			// POST method: post newFriend to /api/friends
			$.post("/api/friends", newFriend, function (data) {
				if (data) console.log("POST successful!");
				else console.log("POST not successful: no data to POST.");
			});

		} // end of main else
	});
</script>